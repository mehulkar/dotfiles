#!/usr/bin/env bash

TRACKER_FILE=~/work-tracker.txt
function track() {
  echo "$1, $(date)" >> $TRACKER_FILE
  stamp=$(cat $TRACKER_FILE | tail -n 1)
  echo "Appended $stamp to $TRACKER_FILE"
}

function workweek() {
  if [ -d ".git" ]; then
    count=$(git log --oneline --since="1 week ago" | wc -l | xargs)
    echo "Stats since 1 week ago"
    git diff HEAD~$count --shortstat
  else
    echo "Not a git directory"
    exit 1
  fi
}

function pip-cd {
  USAGE="Usage: pip-show <pacakgename>"
  if [ -z $1  ]; then
    echo $USAGE
    return 1
  fi

  location=$(pip show $1 | grep Location | awk '{ print $2 }')
  if [ -z $location ]; then
    echo "$1 not found"
    echo $USAGE
    return 1
  fi

  echo "$location"
  cd $location/$1
}

function optimize_workflow() {
  history                           | \
    awk '{print $4 " " $5}'         | \
    awk 'BEGIN {FS="|"} {print $1}' | \
    sort                            | \
    uniq -c                         | \
    sort -rn                        | \
    head -30
}

function dev() {
  track $1
  cd "$HOME/dev/$1"
}

function nom() {
  set -x
  rm -rf node_modules tmp
  npm cache clean
  npm i
  set +x
}

function bom(){
  set -x
  rm -rf bower_components;
  bower cache clean
  bower i
  set +x
}

function bigdir() {
  du -hsx * | sort -r | head -10
}

## Shortcuts
alias ls='ls -alHpGh'
alias be='bundle exec'
alias grep='grep -i --color'
alias egrep='egrep -i --color'
function webshare() {
  PORT=8000
  echo "Starting webserver on $PORT"
  python -m SimpleHTTPServer
}

alias rc='rustc'
alias ow=optimize_workflow
alias ww=workweek
alias vup='vim +PluginInstall +qall'
alias vi=vim
alias tmux='TERM=screen-256color-bce tmux'
alias nombom='nom && bom'
alias dc='docker-compose'
alias dm='docker-machine'

# Git shortcuts
alias gp='git push'
alias gc='git commit'
alias gaa='git add -A'

function mov2gif() {
  file=$1
  output="${file/mov/gif}"
  ffmpeg -i $file  -pix_fmt rgb8 -s 1000x789 -r 15 -f gif - | gifsicle --optimize=3 --delay=3 > $output
}

alias hjs="pbpaste | highlight --syntax=js -O rtf | pbcopy"

function dhjs() {
  highlight -O rtf $1 --font-size 24 --font Inconsolata --style solarized-dark -W -J 50 -j 3 --src-lang $2 | pbcopy
}
